name: Email Updates

on:
  schedule:
    # Run every 6 hours
    - cron: "0 */6 * * *"  # Every 6 hours at :00 (00:00, 06:00, 12:00, 18:00 UTC)
  workflow_dispatch:  # Allow manual trigger

permissions:
  contents: read  # Only need read access for email

jobs:
  send-email:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      
      - name: Install dependencies
        run: |
          pip install requests beautifulsoup4 feedparser
      
      - name: Send email update
        env:
          EMAIL_HOST: ${{ secrets.EMAIL_HOST }}
          EMAIL_PORT: ${{ secrets.EMAIL_PORT }}
          EMAIL_USER: ${{ secrets.EMAIL_USER }}
          EMAIL_PASS: ${{ secrets.EMAIL_PASS }}
          EMAIL_TO: ${{ secrets.EMAIL_TO }}
        run: |
          # Check if all required secrets are set
          if [ -z "$EMAIL_HOST" ] || [ -z "$EMAIL_USER" ] || [ -z "$EMAIL_PASS" ] || [ -z "$EMAIL_TO" ]; then
            echo "ERROR: Missing required email configuration secrets"
            echo "Required: EMAIL_HOST, EMAIL_USER, EMAIL_PASS, EMAIL_TO"
            exit 1
          fi
          
          echo "Sending email update at $(date -u +"%Y-%m-%d %H:%M:%S UTC")"
          python src/processing/send_email.py
      
      - name: Email status
        if: always()
        run: |
          if [ $? -eq 0 ]; then
            echo "✅ Email sent successfully"
          else
            echo "❌ Email failed - check logs above"
            exit 1
          fi

